const {assert, expect} = require('chai')

#IF PLAT_NODEJS
  import { test_ecdsa, validate_ecdsa } from './_nodejs.jsy'

#ELIF PLAT_WEB
  import { test_ecdsa, validate_ecdsa } from './_browser.jsy'


const chrome_instances = @[]
  {"curve":"P-256","hash_alg":"SHA-256","utf8_data":"ecdsa sign P-256 SHA-256","publicKey":"049058ca7b2ae3525949bbf6b40a2542d60c1832036f224e494de152d6d96868016bd6565d4cfc6d77cee327d61f45f63b3c255145f15cb1801d31e67e558c8c32","sig_raw":"c537c48ce3d40b6f9b80025c3016683689c4d481dd15ad99bcb8059302d7e3cf9880026b9fc4a6d3df523b235dc81c377600887eaf2ae4764ebb92555615cc3a","sig_asn1":"3046022100c537c48ce3d40b6f9b80025c3016683689c4d481dd15ad99bcb8059302d7e3cf0221009880026b9fc4a6d3df523b235dc81c377600887eaf2ae4764ebb92555615cc3a"}
  {"curve":"P-256","hash_alg":"SHA-384","utf8_data":"ecdsa sign P-256 SHA-384","publicKey":"044be4e17a8d5e20c2e9ca37227a7066669bb14e972b1549e8cf9aa1f6c40aeffbc198f9ca7b28ae79b7bec682a880d468ad1e21692ab5a85b72b915dbec8731c1","sig_raw":"bb3bd02e3e750272a2466613657beeb243e747460b830ecf3a2b2d497a4d37528d0d14b1905751126945fab2f497745b9195c71dca1acd1135d13eef3b374f04","sig_asn1":"3046022100bb3bd02e3e750272a2466613657beeb243e747460b830ecf3a2b2d497a4d37520221008d0d14b1905751126945fab2f497745b9195c71dca1acd1135d13eef3b374f04"}
  {"curve":"P-256","hash_alg":"SHA-512","utf8_data":"ecdsa sign P-256 SHA-512","publicKey":"04f9a421344aa73977a09e8fbe491778ab583db89e91a2fdd46ad9de629e88d57292e76b2b54d7d60f7e796d8b6bc22a1b8a031122fb3b82c61a662aa47e39f764","sig_raw":"3f189eeab12cf7f685ba1b82d0d542542a2ef7f331bf45484abbce98c8ae26de165cf2c8945eb8163b9a20ccc4753de695b9f421d873b23073c634d75ad162cc","sig_asn1":"304402203f189eeab12cf7f685ba1b82d0d542542a2ef7f331bf45484abbce98c8ae26de0220165cf2c8945eb8163b9a20ccc4753de695b9f421d873b23073c634d75ad162cc"}
  {"curve":"P-384","hash_alg":"SHA-256","utf8_data":"ecdsa sign P-384 SHA-256","publicKey":"04652f7185f2082b7e1902f2f8eb1d07f022ba4ac0ffaa9eed1391e8b1eda7e311ed80333fce89099346d0abdca0168491c20415f2a8440eec869ff316f4c990e068f6c011c3703b527f5913b01ed6246bfbebda3c86433bfb0d2d5ce8d6e1c5cd","sig_raw":"bf944e7e532891c95bf19337c773510713f4ebe79f59ddc7977a9e89b65726ec85eaab19a58cb9d6d5552baa8336a26dceee1fd75e9b13966c72fd395eb2888b5ac287811b56d1e73033ccbb29f9439612cdb248791e62ca0cbe307594a48293","sig_asn1":"3066023100bf944e7e532891c95bf19337c773510713f4ebe79f59ddc7977a9e89b65726ec85eaab19a58cb9d6d5552baa8336a26d023100ceee1fd75e9b13966c72fd395eb2888b5ac287811b56d1e73033ccbb29f9439612cdb248791e62ca0cbe307594a48293"}
  {"curve":"P-384","hash_alg":"SHA-384","utf8_data":"ecdsa sign P-384 SHA-384","publicKey":"04339c51f6b4840d00c7192b8fbf1ca3b5aacf21675b9f9f7d9df9f3ceb4e2e89f1ee8fdbf35685e32a1e544bcc5f571af0815f683c9445a5efb14b2703d7d8aa8b507d1a0d5203440120016d786bc080e46403cc1bfd5a1df3bcd29c05ce9d181","sig_raw":"9bfd8c3649ebf7e57dc57814e62dd1a074986bc5390a47eab81eb39155fd6fea6059f14e92d197af52d6f96ee8f784ded8acbcef7350770139b8df0c9511337a5ad18a89623283b7622b66d9e3f452067fd7459d48383a187fcec259a64b67c0","sig_asn1":"30660231009bfd8c3649ebf7e57dc57814e62dd1a074986bc5390a47eab81eb39155fd6fea6059f14e92d197af52d6f96ee8f784de023100d8acbcef7350770139b8df0c9511337a5ad18a89623283b7622b66d9e3f452067fd7459d48383a187fcec259a64b67c0"}
  {"curve":"P-384","hash_alg":"SHA-512","utf8_data":"ecdsa sign P-384 SHA-512","publicKey":"04dcb99896b7e1ff41686c57d5d552cfb2d73042b10940e9eb7abdb06d6e68ec15475d87544341f400b8d488cb870dadf79c9a62e42e170ffcbeda202d4c208773c8818d49c907f34bc9c13711f3ae7d36afb521eb197c012570c07f0662e1f60e","sig_raw":"4c8942d50903538e1624e112f8b6836962fb153e2d638b820235997cfddea851f48b780c5670fb12881be9a114d4872fa8956563951c7c775414f69d6d21d170993dafc6f70a224afdce9283c217b66b9a3094f9684f07bf12b6d4aa8c027373","sig_asn1":"306502304c8942d50903538e1624e112f8b6836962fb153e2d638b820235997cfddea851f48b780c5670fb12881be9a114d4872f023100a8956563951c7c775414f69d6d21d170993dafc6f70a224afdce9283c217b66b9a3094f9684f07bf12b6d4aa8c027373"}
  {"curve":"P-521","hash_alg":"SHA-256","utf8_data":"ecdsa sign P-521 SHA-256","publicKey":"04001193afb6cc2d74822a04dc91574246a31eea4e36d5b84d9de49e66c1ab6b635ec9d710ccc6065cb23e5e90335a8e228b65bc23c5bc77c0386a7d3632ed6567a90d005015ec7898599c722c9ac38b970961a310059f4a79d7f3a77570065aaf628938603b2cd16b471d82bcd2e71bdaed8790cf7fe860aaab3453ec4b08b20bfa954d37","sig_raw":"018fda97ab0f44cb422add3678f13c22bcf70b68fe2fd95e061d844239b7876c88bcd77e00f3afe57ca7951475d0e94a608700c3a4c6369bf9f84e75e06f5d4c70030086682c118c1d92d6cfb0420663edd4aca37d21fd19275dd36c3393d2d52687f61b607b4950e9129afde3879dc1f8f7ea807d73085063f5c3061473449545c045d8","sig_asn1":"3081880242018fda97ab0f44cb422add3678f13c22bcf70b68fe2fd95e061d844239b7876c88bcd77e00f3afe57ca7951475d0e94a608700c3a4c6369bf9f84e75e06f5d4c700302420086682c118c1d92d6cfb0420663edd4aca37d21fd19275dd36c3393d2d52687f61b607b4950e9129afde3879dc1f8f7ea807d73085063f5c3061473449545c045d8"}
  {"curve":"P-521","hash_alg":"SHA-384","utf8_data":"ecdsa sign P-521 SHA-384","publicKey":"040168c60d0bfc0390fc7b2837cd175ac673faba0cd7305306479985f2df05f6d603c7ed0800810e456c218a91dade8cd4c47322ae19a824309e4e13a84c7e57eeab7800587c984d9c266dabefd31442a61241a0cc5829f4fdb08e464f61ed9c3799b1c7579a5f143f3512d68f70d73104f7628f8d848e7b320b44b33a0566fb5571c652b9","sig_raw":"009f93105ba842eedcf92ed656a0b98738c9a6dd40d946a07866af243a43b61881b162b06e0d556aecb08e8a7ee0fda2cc630b4cb2e3d3fcacf72ba0dd8e5f33721701dd6ebfe390b1584860380f19ce023085f41ce0323a5321d250c2d451a999139c3f4d71a7787241224d7d0d54091953d209bfd5ed124fb25b014bde22f5b845ab75","sig_asn1":"3081880242009f93105ba842eedcf92ed656a0b98738c9a6dd40d946a07866af243a43b61881b162b06e0d556aecb08e8a7ee0fda2cc630b4cb2e3d3fcacf72ba0dd8e5f337217024201dd6ebfe390b1584860380f19ce023085f41ce0323a5321d250c2d451a999139c3f4d71a7787241224d7d0d54091953d209bfd5ed124fb25b014bde22f5b845ab75"}
  {"curve":"P-521","hash_alg":"SHA-512","utf8_data":"ecdsa sign P-521 SHA-512","publicKey":"0400541ad9f5147190758afdd5b68b7c8ef70fadc123b73917ab54e42e7150e9e1dcb3df0c3d3da76352c78638b22e276baa3bdafc97b16c2fb46934472e9c8eaed76b01d18214440e8eb09506a33d323dc6f6981a541f38573ec398ad61db208b2aa8902b8d718655deaa7810f10beaddd8d4ba7d34005a724f6f26346b65c7f5b7b85d10","sig_raw":"01d9201608604eca45dc0994e7e840ddaf2f7b76f67cded29ba2760206d77a3afb5257563d70f26b3f9f7cb1555da784c857de1c5ba28f505008efff401737889898012b1e14668759c7bf7b2dfaa4e1e80bbfb57e3cf8c7f96c1a1e44b1f88ea51db9ed2a4744fef73c8cb3a114c3ee57cc05d8ec65ed421c58d73b8cd080c7dd1a3254","sig_asn1":"308188024201d9201608604eca45dc0994e7e840ddaf2f7b76f67cded29ba2760206d77a3afb5257563d70f26b3f9f7cb1555da784c857de1c5ba28f505008efff4017378898980242012b1e14668759c7bf7b2dfaa4e1e80bbfb57e3cf8c7f96c1a1e44b1f88ea51db9ed2a4744fef73c8cb3a114c3ee57cc05d8ec65ed421c58d73b8cd080c7dd1a3254"}

const nodejs_instances = @[]
  {"curve":"P-256","hash_alg":"SHA-256","utf8_data":"ecdsa sign P-256 SHA-256","publicKey":"04de6ff721173f40049a6554739578f7e91f8e5992da416b63646d14a7f8c7404c0a22e54b7df5890f4329a6a30c0cf8e9d062837a0f951ebbacd73a4b5f7c948f","sig_raw":"24ee6f0d95ce2efd1ad0b69d28b5cca9a04eccd5c57b7cfd1d15ea7d1f22b7c2208b6a1cba2db20a7abe7974d863e353faedb17a9475149fe37d3606cfb4378a","sig_asn1":"3044022024ee6f0d95ce2efd1ad0b69d28b5cca9a04eccd5c57b7cfd1d15ea7d1f22b7c20220208b6a1cba2db20a7abe7974d863e353faedb17a9475149fe37d3606cfb4378a"}
  {"curve":"P-256","hash_alg":"SHA-384","utf8_data":"ecdsa sign P-256 SHA-384","publicKey":"04424ff51deba07611a42cb29fc55aa133b74ed65243a99b3e2dcbd3fdbe09b36d2b29b788816e0d6ce291b7bc07b27b66d2fab29c2a1ce95350cb5ddcee8b018c","sig_raw":"c1334ef9c7a4c93c8f018b96edb41212b823bf4ca76fde84e64d06172edc894faeab1f7a093b4a0bb5594a0b49143ca42b511fde7149a6dabb8c21814bab96e8","sig_asn1":"3046022100c1334ef9c7a4c93c8f018b96edb41212b823bf4ca76fde84e64d06172edc894f022100aeab1f7a093b4a0bb5594a0b49143ca42b511fde7149a6dabb8c21814bab96e8"}
  {"curve":"P-256","hash_alg":"SHA-512","utf8_data":"ecdsa sign P-256 SHA-512","publicKey":"045f9c07d9db524f4fb6bf17130b794fac705862440a0436c89fefa571959651d3161c97f90a161664d835e13942f240a65313fa8bf1d347e0c08f708d0475394a","sig_raw":"e94ad92debc1c4b6ab8dfe112d25bd0c03d7e8ec796dda5698d5169ddd656844e464895ef4df9faaff92450e772b27702d6044e673b442c5a427e9e12500125b","sig_asn1":"3046022100e94ad92debc1c4b6ab8dfe112d25bd0c03d7e8ec796dda5698d5169ddd656844022100e464895ef4df9faaff92450e772b27702d6044e673b442c5a427e9e12500125b"}
  {"curve":"P-384","hash_alg":"SHA-256","utf8_data":"ecdsa sign P-384 SHA-256","publicKey":"04e99d497ef3f4c4f8b24476d2e504c5f11c9bd891e6b8c2d2ab6993913b11f2f5dddaaedc6d5e96d10795a3339819de4e02cfe7df48ca40f63dafabf789774467e1c69b9879a388fbf8949a94a5a5b3b81ab312ae2e2dc800e6123d88df1696d5","sig_raw":"56108ba98b8e66334486dd95e9d58c12faa7c706cb523fddcc3f971212bad00e403502317caa3c3941c6bb9bb641975281692cb3d4158a7468a0913c99ee22d6ceb9f58cd3921f22039c714d7f038447645824679d9154b0ca895f0f7e291b1a","sig_asn1":"3065023056108ba98b8e66334486dd95e9d58c12faa7c706cb523fddcc3f971212bad00e403502317caa3c3941c6bb9bb641975202310081692cb3d4158a7468a0913c99ee22d6ceb9f58cd3921f22039c714d7f038447645824679d9154b0ca895f0f7e291b1a"}
  {"curve":"P-384","hash_alg":"SHA-384","utf8_data":"ecdsa sign P-384 SHA-384","publicKey":"04e2d56a886943f88bad3e91c25f55fa401a8dd084f2acd398d93e406b866f05bad8145cf1e5b432f98873b673e478aae98582a9936b97e3c6eb00afeb40de0dd285b605fdd31323c21b922be44cacbc61c09648bf419d20317e2bbf9e1b1d4d0a","sig_raw":"ef38c1b5da3c0d6c9c53a08b139fb77e8f75b88d0806a854092a1bda0861d61e1296c1ef3c53e341caeb8e8c920fd3d84ee362970f4d4ccf0126850cc41bed6a2bae7ee38efac61ecbd005923db05bb534b5aac32e354de5a15e8dcc12e42053","sig_asn1":"3065023100ef38c1b5da3c0d6c9c53a08b139fb77e8f75b88d0806a854092a1bda0861d61e1296c1ef3c53e341caeb8e8c920fd3d802304ee362970f4d4ccf0126850cc41bed6a2bae7ee38efac61ecbd005923db05bb534b5aac32e354de5a15e8dcc12e42053"}
  {"curve":"P-384","hash_alg":"SHA-512","utf8_data":"ecdsa sign P-384 SHA-512","publicKey":"0401a88359ec65f24383d8f22025c2f0f5c2f967814ffc17114dd9be91b9636a60308f2be9f29e1cce6544912c2f29bc0757cda6a21e5ed0608695b4ac40715a1a1fb70ade31f0450c00fc3a52424f82f5b1e0b021724f94bb01dfe66ea5bc90ff","sig_raw":"5fea4c299190e0f22b048e7b807cd61ff64123f0e736798f56dbad96e4fe0883f608e0f7a379ef39bbdb8341c0e45c2f0d014a81e0d58105a03bec4070e01620605b47c5059aa4165b4059df883e62b6d7cba822ffeef62fdd5e843d6cb7c757","sig_asn1":"306402305fea4c299190e0f22b048e7b807cd61ff64123f0e736798f56dbad96e4fe0883f608e0f7a379ef39bbdb8341c0e45c2f02300d014a81e0d58105a03bec4070e01620605b47c5059aa4165b4059df883e62b6d7cba822ffeef62fdd5e843d6cb7c757"}
  {"curve":"P-521","hash_alg":"SHA-256","utf8_data":"ecdsa sign P-521 SHA-256","publicKey":"040018a21837b683ac5cf402b9b0b5d2fd5b5eeeed749f409c5d91f3bc68ecefcdc335364eb735dbc7c68a390b512985304e84be434ea0eab4ca53d2c6b7c337c07771018b0a6b19a4517d8a2f4780c4cf225fbda49999f49506555c2df4cf71491ea261a2d17f09d7529cf01b984109ce28add7a48fff0cff2ed5ebab0b6d6d935514b679","sig_raw":"00afa7a2b2c346fa21afe154af90c37fd8bea003777eeb058bd266060296517ce7efce69ad9196f27f48b959ec4c584cb963c520dede1ebb2a39106df544c98d970000a1ba71393498d5b36dad813e17e6602be87ef8592b1d50c6c263f64c67c42ead2396a9850d983a54bc995cdd60ba5ff4e5cd20c11b19f2ac99b1b968f8ff6e76f9","sig_asn1":"308188024200afa7a2b2c346fa21afe154af90c37fd8bea003777eeb058bd266060296517ce7efce69ad9196f27f48b959ec4c584cb963c520dede1ebb2a39106df544c98d9700024200a1ba71393498d5b36dad813e17e6602be87ef8592b1d50c6c263f64c67c42ead2396a9850d983a54bc995cdd60ba5ff4e5cd20c11b19f2ac99b1b968f8ff6e76f9"}
  {"curve":"P-521","hash_alg":"SHA-384","utf8_data":"ecdsa sign P-521 SHA-384","publicKey":"0401bf3eddf7ff9f3adbd9c5190bc1943f2977d6abe5d20190bc24c59d5d062d6e67513a332ee579855578338d2e951a9aced1666b0a9afd12ec5fb676bf4046ba6c4900c8c3dc25bf3f904089c1a2c3fe1b1c94ee1a17ed6956fff308de2bb6736d4797b42c4ebc8aa1973180e026a94d9e9295b9c76adda3b15fc044f6b731b5332acdd6","sig_raw":"00f38c7d7b550037bcc0efcaf3d5f2b9887886b28a641850e591ff2de18614c2d8805194b3fabdc2c173aa14b0bc933606c1240e40e93c5787ea8762cd0f553013780018b829d52c71a3c3a146e3fc8b1ba7d6143ebc48a6903a9ffb779c9b93696ae063a90ac3d2227ec758f621cddfbaa802795e9c5cba067a7f2117beb4fa220ba16e","sig_asn1":"308187024200f38c7d7b550037bcc0efcaf3d5f2b9887886b28a641850e591ff2de18614c2d8805194b3fabdc2c173aa14b0bc933606c1240e40e93c5787ea8762cd0f55301378024118b829d52c71a3c3a146e3fc8b1ba7d6143ebc48a6903a9ffb779c9b93696ae063a90ac3d2227ec758f621cddfbaa802795e9c5cba067a7f2117beb4fa220ba16e"}
  {"curve":"P-521","hash_alg":"SHA-512","utf8_data":"ecdsa sign P-521 SHA-512","publicKey":"04012746f11a9f0f968ba565ded114157e84c9b1c4d3e4de4a894a0e169e7e9fd8f0fc9f7c3518a102b7147e24a044fcad90d45c1b89cec2cd23e1063ee54019e5ddae009330e12227dc2b60a18fa3a81f33075469867713a46065238007f3e5744e39fa50a26569c868ef8074b9d4c944d54d3510d496f7f3506bc057d3d563ac60bb8a4c","sig_raw":"0148178bcdd26cfbfcbe5b2f6c5f364fedb70136b363ce2c40a0975a104ced9b2f982c40350761cede6dee0e1cc1b3f42faf08840940224fd30652dde0cbd4317a57017f80394c54987f150f10384db40f3076e92b0dde32610f625ad2b0c2acceac7883d6cd7b29dcc9c16ccce79c7baa1f341c6a1be9b7c20f366554e6e694311eab23","sig_asn1":"30818802420148178bcdd26cfbfcbe5b2f6c5f364fedb70136b363ce2c40a0975a104ced9b2f982c40350761cede6dee0e1cc1b3f42faf08840940224fd30652dde0cbd4317a570242017f80394c54987f150f10384db40f3076e92b0dde32610f625ad2b0c2acceac7883d6cd7b29dcc9c16ccce79c7baa1f341c6a1be9b7c20f366554e6e694311eab23"}

describe @ 'ecdsa', @=> ::

  describe @ 'generated', @=> ::
    for const curve of ['P-256', 'P-384', 'P-521'] ::
      for const hash_alg of ['SHA-256', 'SHA-384', 'SHA-512'] ::
        it @ `ecdsa sign ${curve} ${hash_alg}`, @=>>
          test_ecdsa @ curve, hash_alg,
            `ecdsa sign ${curve} ${hash_alg}` 

  describe @ 'Chrome-sourced instances', @=> ::
    for const each of chrome_instances ::
      it @ each.utf8_data, @=>>
        validate_ecdsa @ each

  describe @ 'NodeJS-sourced instances', @=> ::
    for const each of nodejs_instances ::
      it @ each.utf8_data, @=>>
        validate_ecdsa @ each

